@page "/{*remaining}"
@using CWCTMA.Model.XMD
@using CWCTMA.Helpers
@using Markdig
@using System.IO
@using Microsoft.AspNetCore.Html

@if (File.Exists(FileName))
{
    var markdownFile = File.ReadAllText(FileName);
    var header = $"{markdownFile[0..(markdownFile.IndexOf("</metadata>", StringComparison.OrdinalIgnoreCase)+"</metadata>".Length)]}";
    //header.ParseXml<Metadata>();
    markdownFile = markdownFile[(header.Count())..];
    @((MarkupString)Markdown.ToHtml(markdownFile, Globals.MarkdownPipeline))
}
else
{
    @((MarkupString)Markdown.ToHtml("]>danger< # Error 404\r\n] Sorry, there's nothing at this address.", Globals.MarkdownPipeline))
}


@code {
    [Parameter]
    public string Remaining { get; set; }
    
    public string FileName => Path.Combine(Globals.ContentDirectory, $"{(Remaining ?? "index")}.xmd");
    
    public IEnumerable<string> RemainingList {
        get
        {
            return Remaining?.Split("/");
        }
    }
}